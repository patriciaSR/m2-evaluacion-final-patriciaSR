"use strict";const showInput=document.querySelector(".finder__input"),finderButton=document.querySelector(".finder__btn"),resultList=document.querySelector(".show-result__list"),favouriteList=document.querySelector(".show-favourites__list"),resetButton=document.querySelector(".show-favourites__reset-btn"),ENDPOINT="http://api.tvmaze.com/search/shows?q=",defaultImage="https://via.placeholder.com/210x295/ffffff/666666/?text=TV";let shows=[];function sendRequest(){const e=showInput.value;fetch(ENDPOINT+e).then(e=>e.json()).then(e=>{resultList.innerHTML="";for(const t of e){let e="";e=t.show.image?t.show.image.medium:defaultImage;const o=createShowElement({title:t.show.name,image:e,id:t.show.id},!1);for(const e of shows)e.id===o.getAttribute("data-id")&&o.classList.add("favourite");resultList.appendChild(o)}})}function createShowElement(e,t){const o=document.createElement("li"),s=document.createElement("img"),i=document.createElement("h3"),r=document.createElement("i");return o.classList.add("show__item"),o.setAttribute("data-id",e.id),s.classList.add("show__img"),s.src=e.image,s.alt=e.title,i.classList.add("show__title"),i.innerText=e.title,o.appendChild(s),o.appendChild(i),t?(o.classList.add("small"),r.classList.add("fas","fa-times-circle","show__remove-btn"),r.addEventListener("click",()=>{removeFavourite(e)}),o.appendChild(r)):o.addEventListener("click",toggleFavouriteFromResults),o}function toggleFavouriteFromResults(e){const t=e.currentTarget;if(t.classList.toggle("favourite"),t.classList.contains("favourite"))createShowFromFavourites(e);else{const e=t.getAttribute("data-id");favouriteList.querySelector(`[data-id="${e}"]`).querySelector("i").click()}}function createShowFromFavourites(e){const t=e.currentTarget.querySelector("h3").innerText,o=e.currentTarget.querySelector("img").src,s=e.currentTarget.getAttribute("data-id");if(-1===findFavouriteIndex(s)){const e={title:t,image:o,id:s},i=createShowElement(e,!0);favouriteList.appendChild(i),shows.push(e),localStorage.setItem("shows",JSON.stringify(shows))}}function findFavouriteIndex(e){let t=-1;for(let o=0;o<shows.length;o++)shows[o].id===e&&(t=o);return t}function removeFavourite(e){removeShowFromResults(e),removeShowFromFavourites(e)}function removeShowFromResults(e){const t=resultList.querySelector(`[data-id="${e.id}"]`);t&&t.classList.remove("favourite")}function removeShowFromFavourites(e){favouriteList.querySelector(`[data-id="${e.id}"]`).remove();const t=findFavouriteIndex(e.id);t>-1&&shows.splice(t,1),localStorage.setItem("shows",JSON.stringify(shows))}function resetFavourites(){const e=shows.slice();for(const t of e)removeFavourite(t)}function loadFavourites(){const e=localStorage.getItem("shows");if(e){shows=JSON.parse(e);for(const e of shows){const t=createShowElement(e,!0);favouriteList.appendChild(t)}}}finderButton.addEventListener("click",sendRequest),resetButton.addEventListener("click",resetFavourites),loadFavourites();